import React, { useState, useEffect } from "react";
import { MapContainer, TileLayer, Marker, Popup, Polygon, useMap } from "react-leaflet";
import WeatherLegend from "../../WaterLevelLegend";
import "leaflet/dist/leaflet.css";
import L from "leaflet";
import RainIntensityLegend from "./WolfsteinLegend";
import RadarFetcher from "./FetchPrecipitationMap"; // Import the new component


const polygonLandkreisKusel = 
[[49.65251517970531, 7.703330490343141], [49.651593797371675, 7.701748271068421], [49.65096798915793, 7.697195283504398], [49.64943075016851, 7.693652759908822], [49.6478432426096, 7.692442783807161], [49.64759748758005, 7.691971960538115], [49.645511318989875, 7.688808801160237], [49.644044586465114, 7.686302594425934], [49.64238672631936, 7.682268940472535], [49.642211149579005, 7.681364301931844], [49.6398342844838, 7.67738734949228], [49.64016141780585, 7.67570442493467], [49.63976791238395, 7.669683415153542], [49.63787127251948, 7.666205483930388], [49.636767236383456, 7.664705442891232], [49.63594759653483, 7.663730632374052], [49.63662448583843, 7.662079255509729], [49.636993889136555, 7.660445920894405], [49.63719849861658, 7.657969006791773], [49.637663050647696, 7.65673830366413], [49.63815398280671, 7.655799431637784], [49.63843854481456, 7.654990212464016], [49.63953111769978, 7.654484931158948], [49.64000031278021, 7.654955804981239], [49.6405835369015, 7.655175547420292], [49.641459992516594, 7.654943076303909], [49.64305793069332, 7.654043695664207], [49.64356296327781, 7.653361956445639], [49.64551705648742, 7.65266306912405], [49.645524272471164, 7.654381882928481], [49.64782481842677, 7.658154774289209], [49.65001569229054, 7.659355445285029], [49.65065644940286, 7.657265083589626], [49.653639561614746, 7.656671337798318], [49.65588017039843, 7.657342147110918], [49.65672261106149, 7.658623290896091], [49.65850686205032, 7.662996583137957], [49.659485355232206, 7.667917310928967], [49.65983312367713, 7.66670393850425], [49.664796106463136, 7.666076276614411], [49.66556577726136, 7.666252481403077], [49.666705883785184, 7.669000549906942], [49.66815315858001, 7.670794983294454], [49.668212903359574, 7.672166174940436], [49.667630372620366, 7.673339759933445], [49.66808856560445, 7.674333836573266], [49.66957917885476, 7.673793821108378], [49.67031894348872, 7.672096198352273], [49.673577613856345, 7.664777609999303], [49.674700259874726, 7.66430854738351], [49.676553611046636, 7.665336001309817], [49.67752606191818, 7.663183211887521], [49.67953025175336, 7.665200690616843], [49.68069287315962, 7.66309195077796], [49.681389393022506, 7.66502079570092], [49.68269479576226, 7.664259063736925], [49.68396434257978, 7.663673752088276], [49.68404851988863, 7.667037413439282], [49.68371643796902, 7.668741463474344], [49.68487726221531, 7.670212523860051], [49.68547444131994, 7.670369583516187], [49.6855740896553, 7.672154241261941], [49.68572623051737, 7.673560612994685], [49.68790726390092, 7.673589174195501], [49.68779145508198, 7.672352783291845], [49.68793707380701, 7.671341082549622], [49.688788929633326, 7.669968727156632], [49.69233725387769, 7.665382920549781], [49.693299424047105, 7.664257054537906], [49.69499419850337, 7.662546259574362], [49.698170995223855, 7.661001766498205], [49.698869899683416, 7.660754481988907], [49.6994217217382, 7.660721614518646], [49.701142184542505, 7.659414494536358], [49.701619589845954, 7.65855665757167], [49.701598037235975, 7.65769731150937], [49.69951917351603, 7.654503814024555], [49.69867626331671, 7.652846849167066], [49.69481067951968, 7.649496871691908], [49.69327420659163, 7.647930383937657], [49.6902863950529, 7.645021112269286], [49.68829460757299, 7.64422447071312], [49.68699272831455, 7.642581696708967], [49.685688325310586, 7.638344229036735], [49.68453939192292, 7.634208650283711], [49.68438224273272, 7.63084614906295], [49.68477589783936, 7.628616105722195], [49.68435339418404, 7.623673811299216], [49.686444212462526, 7.619148674372823], [49.684314231657225, 7.609050426493255], [49.68405709912941, 7.607442476499214], [49.68202642739467, 7.60337515337617], [49.679807068097354, 7.599680401148566], [49.68125206832671, 7.595637948540693], [49.68354451107309, 7.593806091801905], [49.68418410267733, 7.594113333788507], [49.684642610794654, 7.592683845784794], [49.685027406788144, 7.591189441795795], [49.68393148310476, 7.586732553270511], [49.68449270275517, 7.585449361472225], [49.68556742823512, 7.585577946455507], [49.68870440984665, 7.577336976780479], [49.6879243174687, 7.573276973697172], [49.687112301253954, 7.570779296499619], [49.68614214618123, 7.566336698632729], [49.68603326219324, 7.564914036141018], [49.686578084415004, 7.56231316542008], [49.68899728731973, 7.560124009769276], [49.69025936232121, 7.558450149732209], [49.69164648916234, 7.555352821023302], [49.69210516600159, 7.552909517876251], [49.69280130160823, 7.553019157170008], [49.69283788359651, 7.547853761273013], [49.695267778373115, 7.547120319136265], [49.698508581628595, 7.550556398346099], [49.69801766849509, 7.546228165303414], [49.69872866959152, 7.544490607554684], [49.70087243775945, 7.544524264203409], [49.702053228364285, 7.544228934197037], [49.70168627333339, 7.542932897694885], [49.70259407311287, 7.542182463063341], [49.70202396273411, 7.541037859900947], [49.70197491382186, 7.540194095024708], [49.70251130578015, 7.539702670895772], [49.703297347995395, 7.539806558454926], [49.70632809554309, 7.541395391703256], [49.708125032027034, 7.540214777203252], [49.70884784543158, 7.536865460328873], [49.713584249966644, 7.539292506241038], [49.71292574814304, 7.536834058468726], [49.713989589447486, 7.536198593849301], [49.710040118510705, 7.530473867592059], [49.7083527257406, 7.526899727750535], [49.70762257222502, 7.522752341734567], [49.705849476180944, 7.52483454414519], [49.70525968409949, 7.525690469951166], [49.70448811627151, 7.524766811022015], [49.700506993257626, 7.520600884330912], [49.69811928796531, 7.519167671195143], [49.69651704574617, 7.519184577315727], [49.694550877659424, 7.521111934648493], [49.692134876404054, 7.522026265532556], [49.69115299911479, 7.522351301128626], [49.68872472580659, 7.521851635243259], [49.6875558075426, 7.521146514375163], [49.68698840393744, 7.521140330567812], [49.685782532885845, 7.521507097416412], [49.68252313983889, 7.526303845176324], [49.67973970755116, 7.521801280335787], [49.678805940322064, 7.521901223620233], [49.67858131336333, 7.518154997129776], [49.6782856402779, 7.517868226308527], [49.67781575080359, 7.517034102245562], [49.67736004000185, 7.515833954662431], [49.67636220926904, 7.509517973056327], [49.678098709902834, 7.508467961072755], [49.67762221508989, 7.506484931276243], [49.67758458123951, 7.505703038389035], [49.67810312663717, 7.502219715081375], [49.67814668568718, 7.501301999108304], [49.67806511714076, 7.499503317479483], [49.67791337005244, 7.498258043583499], [49.677583256624644, 7.496684163643854], [49.67674259678059, 7.494410510576871], [49.67654491149522, 7.493237959564086], [49.67655613960191, 7.491860397645357], [49.6766842927033, 7.490937360337996], [49.6771000462992, 7.489054252329717], [49.67487571942171, 7.490734770400686], [49.67550327835142, 7.487352146255897], [49.6760600488193, 7.482140992828398], [49.678035934938, 7.481806810535078], [49.67809022279722, 7.48010392683944], [49.67803938901784, 7.478512631646827], [49.67705444417937, 7.47768460992646], [49.67607442869081, 7.47759148060977], [49.67601199562408, 7.476523640239632], [49.67570638801723, 7.474608563850022], [49.676593505178275, 7.474160157127455], [49.67732560733689, 7.472989591234656], [49.67661227597817, 7.470420689802309], [49.67597965944768, 7.468644418532197], [49.675634907601406, 7.468130061749747], [49.67488292969022, 7.467289077580885], [49.673894550319275, 7.466489296346052], [49.67335208382293, 7.465263465300039], [49.67244213717096, 7.464734028173286], [49.67296162021319, 7.459943462668778], [49.67305658888252, 7.456383949251729], [49.67398614614347, 7.453759832844861], [49.67228475293078, 7.450094730539803], [49.6711716955863, 7.447958622751109], [49.670955355560395, 7.447003379093266], [49.67085079108964, 7.445952886217493], [49.66972913991078, 7.44464452678122], [49.66795814327305, 7.444699244480858], [49.66692416912819, 7.445970509422573], [49.66595874370859, 7.446178026800021], [49.66526827497014, 7.446016692643317], [49.66461190392733, 7.445706367073726], [49.6640086555783, 7.44524583850563], [49.66356947655048, 7.445215240565611], [49.66305427516922, 7.443780159508946], [49.6628308017456, 7.441856625055906], [49.66235675981441, 7.441241070436949], [49.66096712390974, 7.43848222577806], [49.660594535631965, 7.438095096382744], [49.66034085388196, 7.437171861747397], [49.65952511488022, 7.436607686845134], [49.656966125579174, 7.435715121446185], [49.65711898391297, 7.434656256150459], [49.65696651948241, 7.433681292380686], [49.65666349261003, 7.432799233296378], [49.656136120947686, 7.431945482230887], [49.655382528364136, 7.431050823886221], [49.65473491359767, 7.430080027961899], [49.65383318224928, 7.427045264426967], [49.65351694377323, 7.425678740890782], [49.6527656346152, 7.425532990678155], [49.65170499327698, 7.425601336396103], [49.65072186416271, 7.425539871643842], [49.6492990519514, 7.425534476286763], [49.64917738554089, 7.426027684093992], [49.648859474081476, 7.426589000364074], [49.64840965039518, 7.426779637991029], [49.64770092729296, 7.426649170651197], [49.64649905515803, 7.425904734777065], [49.64585297946101, 7.425975708240775], [49.64523706994022, 7.426455648555893], [49.643719222322375, 7.426754741472167], [49.64287003048701, 7.427066237570163], [49.64192089311727, 7.428961653854238], [49.64108951458332, 7.429051840937912], [49.64024534862413, 7.430426809974927], [49.640454608605964, 7.433751664062838], [49.639883838172246, 7.433788336042117], [49.639371513212765, 7.433344361412781], [49.638265359716335, 7.431042375426996], [49.63765204889217, 7.429676535629375], [49.636468908818145, 7.42997273818754], [49.63598836106914, 7.43070059600126], [49.63480025272188, 7.430813679853102], [49.6340541244848, 7.431411857145006], [49.63352898192891, 7.432252566183141], [49.63264278842126, 7.433219919027714], [49.63213187005012, 7.434322991233086], [49.63155911655093, 7.434286421340373], [49.63009382623288, 7.433854995135598], [49.62899260775919, 7.433644383864229], [49.627443799066874, 7.433633848668673], [49.625570973908026, 7.43397418603051], [49.62408544241923, 7.435292053242488], [49.62213351952791, 7.435478418416094], [49.620111073559066, 7.43645162146147], [49.618761447058674, 7.439398324995849], [49.61766743725084, 7.441228473333524], [49.61691920774479, 7.443513063004684], [49.61728011941826, 7.44680386389546], [49.61705796687666, 7.447580269181687], [49.616582264461734, 7.448303581867035], [49.61580698269742, 7.448602572786968], [49.615275882790996, 7.448941381390362], [49.614954508578954, 7.447420812448614], [49.61447185844111, 7.445779766716987], [49.61382269990864, 7.444325395940107], [49.61275086392589, 7.44412808145564], [49.612332177914524, 7.443628316163331], [49.61161577633599, 7.442440929937995], [49.61104652338629, 7.4420339719682], [49.609194558343056, 7.441141080386581], [49.608718170400195, 7.441171594810887], [49.60749875899357, 7.44036295105653], [49.60557443644127, 7.442121111347206], [49.60397901494921, 7.441391995916075], [49.601875739163376, 7.440861705224774], [49.599775430576656, 7.441439527939988], [49.59907580712608, 7.44220468417635], [49.598257070782125, 7.443226790665772], [49.59779641739314, 7.443173154734518], [49.596953802194804, 7.441980364224301], [49.595736280426884, 7.440908589776295], [49.59398618724288, 7.439787877440645], [49.5924173436088, 7.436716476820962], [49.592031519023514, 7.433777101290199], [49.592451679047784, 7.432669743058638], [49.59252380361343, 7.430019535760409], [49.59244303251148, 7.427046722214829], [49.5935198765431, 7.424594988986225], [49.59454638659701, 7.424265715734695], [49.59407798065319, 7.422273527569441], [49.59253358634315, 7.423093294694277], [49.59241924081863, 7.425178341338921], [49.59149979911276, 7.425140565129968], [49.59131117568375, 7.423172028896884], [49.58976141771195, 7.420487899325463], [49.59080949725378, 7.419298424039254], [49.591179991166605, 7.417695529339309], [49.591335744678055, 7.415483177734734], [49.59211683488327, 7.414740183368693], [49.59140784413693, 7.412846833064554], [49.59104679816929, 7.411166503297011], [49.59161966366167, 7.409065649787635], [49.59337815594063, 7.411140418031786], [49.59422478112213, 7.410490043296976], [49.59316991876129, 7.40813424673351], [49.59475289532151, 7.407740892937712], [49.59436613248846, 7.405452660401021], [49.59534565571798, 7.404724296822459], [49.594877284352, 7.402746094457722], [49.5942748978042, 7.398837351894513], [49.59442950504692, 7.397580634686721], [49.59465401874769, 7.396561043505763], [49.5954008889375, 7.394262253972427], [49.59671392483894, 7.395188126036619], [49.59657942167806, 7.391276565730912], [49.597365743298866, 7.389267170151071], [49.597885336246776, 7.388355191252003], [49.60043025695324, 7.384625457194049], [49.59996986208661, 7.383602604824062], [49.59886038127293, 7.384838679952962], [49.59859832985145, 7.383498145849695], [49.597004923151225, 7.383837608610753], [49.5962266083823, 7.383694447661242], [49.59621735480071, 7.382379050799323], [49.59476850781283, 7.380451186923702], [49.595884428115916, 7.379450185532752], [49.59617634288464, 7.37763026864589], [49.5988594645632, 7.374365545935566], [49.59751278705972, 7.371904701648374], [49.59612413262492, 7.368255409443271], [49.59585338742692, 7.363036850882033], [49.59571873003086, 7.362727083262676], [49.59460524368444, 7.361539652744954], [49.59131765275019, 7.359234689673483], [49.589681056027295, 7.357694026034738], [49.58850719841603, 7.355956807132347], [49.58788327995902, 7.35295076867297], [49.586905673288236, 7.35082683672257], [49.58627240963474, 7.350397678831229], [49.585085857126565, 7.352733396524934], [49.58369623903059, 7.3555393864343], [49.58238207684591, 7.355556630699906], [49.58275825456139, 7.34934137777258], [49.582112480524124, 7.346849625401159], [49.58036998691854, 7.347006161075575], [49.578999550109835, 7.345974908589557], [49.57934435556832, 7.34445655861117], [49.57913916155166, 7.34226827639103], [49.578540192890195, 7.340812291804611], [49.576282124755856, 7.340241524779797], [49.57501919098344, 7.338871115202427], [49.57317832798286, 7.338729807129925], [49.572766502140404, 7.337737205206435], [49.573022574422325, 7.335991085629908], [49.57285909188217, 7.334917515412641], [49.572080267503296, 7.333650259686396], [49.570623771415356, 7.333365774449481], [49.570804382208465, 7.334663918866265], [49.569265146523435, 7.33468279453368], [49.56858981507557, 7.33602309762456], [49.5668878575023, 7.335643221514121], [49.56503640078954, 7.333941080228673], [49.56383099683351, 7.331735333539385], [49.56494439779742, 7.331339193495406], [49.56578751124365, 7.326067231094169], [49.56297017683962, 7.326869655805191], [49.56412349958919, 7.325181435968774], [49.56501074204774, 7.322020371024407], [49.562904820777334, 7.319820840584309], [49.56232579926701, 7.319084138293747], [49.561603502924754, 7.319639871944774], [49.560067066626715, 7.32007172788407], [49.56018778752759, 7.321821722981173], [49.55803100709207, 7.322221485986899], [49.5583410437854, 7.32307985362683], [49.557744350605276, 7.323888605491344], [49.556511558726214, 7.324620110746879], [49.55590943735524, 7.324341753239522], [49.55522935301434, 7.322892076102832], [49.55495231771164, 7.32033870867858], [49.55602035683633, 7.320194423815837], [49.55643615335432, 7.318884971550069], [49.55637736515089, 7.317643712010601], [49.5561521046451, 7.316413539756876], [49.55636834111579, 7.314787738050815], [49.556793087081665, 7.313832540089685], [49.556176227878744, 7.312200331219922], [49.55684020712107, 7.310078269480455], [49.556458882727604, 7.308373500155962], [49.555882918414405, 7.307429203145939], [49.55522367580022, 7.308317553444706], [49.55341640935915, 7.307455510494861], [49.555544923107355, 7.303756099264586], [49.554281938553274, 7.302082716341179], [49.55347652576598, 7.300669455231614], [49.552861655830625, 7.297084323352518], [49.55242910146905, 7.292947261142227], [49.552512515165006, 7.291128531304991], [49.55223955277006, 7.286911609340504], [49.55148332125834, 7.28406977493601], [49.55105076463697, 7.282161219996546], [49.55075356149643, 7.279316280983457], [49.54965687211923, 7.278435198945354], [49.54862364005399, 7.276622618794519], [49.548101929540984, 7.275605223112841], [49.545147005547825, 7.275496190969998], [49.54413994000331, 7.276329827583777], [49.54317284810898, 7.276519570423025], [49.542031841557886, 7.276610326425156], [49.54057934999444, 7.276514513406286], [49.53898974202178, 7.276471134403613], [49.53785145380488, 7.27608263701045], [49.53742342840282, 7.276111492487261], [49.537098864974986, 7.276426243427098], [49.53680955340311, 7.277141308526069], [49.53690715919568, 7.278891947530334], [49.53690839367949, 7.279770471470675], [49.536793849510744, 7.280766615826894], [49.53573533624815, 7.285059577768187], [49.53481230973691, 7.288990128939695], [49.5346253085122, 7.28995445796607], [49.534564565100474, 7.292008505094359], [49.53444356117272, 7.294393620096046], [49.53438521461904, 7.299727412281864], [49.5345474325711, 7.302762206919885], [49.53396181897557, 7.302405554252013], [49.53313847596898, 7.30065531868561], [49.53137603733371, 7.298965856981706], [49.529558005122546, 7.299706059580249], [49.53027811867152, 7.300846650793914], [49.52740525793722, 7.302786770928225], [49.526135682205485, 7.306924695198102], [49.52322051691295, 7.309871873369899], [49.52145335212478, 7.306983384773693], [49.5199510056484, 7.307831433635208], [49.518762426582654, 7.303849759887679], [49.51796833404837, 7.301048505901895], [49.51792480138152, 7.298672827649253], [49.51913464956528, 7.298816768588226], [49.52054973484366, 7.302359736773149], [49.521630390477526, 7.30164534006148], [49.520621192649934, 7.298821749785914], [49.52108647654849, 7.298423358423094], [49.52289321405311, 7.297114424348679], [49.52205912232679, 7.293987388750836], [49.521581984407526, 7.292315900848832], [49.520333425764186, 7.292751777808376], [49.520088242873754, 7.291491516084441], [49.519500674001975, 7.289511569875688], [49.518581764332986, 7.287913523896112], [49.51712094197835, 7.286891330398378], [49.516906605196844, 7.285688643866497], [49.514107124253755, 7.28761925556429], [49.51320906562063, 7.28869264272186], [49.51231510778142, 7.287919741391135], [49.51156608440272, 7.285660201441846], [49.51140060442506, 7.284592664691253], [49.51103273244473, 7.283690856812668], [49.51051128141416, 7.282771731305049], [49.50853987153548, 7.283156127752552], [49.50723269785258, 7.282539876977826], [49.505524844516664, 7.280944440668706], [49.50515227519897, 7.282094987384141], [49.50465312513435, 7.285433194187181], [49.504349351862324, 7.284568681042589], [49.50384319029664, 7.283869874720883], [49.50275554035105, 7.28298894736158], [49.50194701203925, 7.282739122034307], [49.50155511117705, 7.282889902704262], [49.501656394375516, 7.283284050834878], [49.50151592366999, 7.284358098206449], [49.50120940117314, 7.285609203551778], [49.50090084792069, 7.286473304596077], [49.50018191267713, 7.286839568151799], [49.4990628181173, 7.287066779382531], [49.4980425477633, 7.284757366441149], [49.49633000143925, 7.28343465705376], [49.495464167145585, 7.283067976162735], [49.4922863168067, 7.282780221469868], [49.48845859094869, 7.281489376219236], [49.487112843530845, 7.279769183227098], [49.48603051860006, 7.281915228328146], [49.48464625190015, 7.27916111078761], [49.484274793424596, 7.27813569687034], [49.48374641760208, 7.279498067685184], [49.48368575659133, 7.282736244451563], [49.483205187424524, 7.285145710219564], [49.48329370621763, 7.288885192627632], [49.48306382625601, 7.290932249968321], [49.48210707872097, 7.29275156721699], [49.48301040595921, 7.294661258287464], [49.483385542356196, 7.295913791797567], [49.483549653213025, 7.296841236680394], [49.47880266479815, 7.299773565304666], [49.4767281559751, 7.301195850878571], [49.47555595282123, 7.303996384529771], [49.47419534971408, 7.304916276394348], [49.472445941201954, 7.304825738909923], [49.47137376259199, 7.302946079764422], [49.470072284783676, 7.301409832762264], [49.46894938317337, 7.300596299607892], [49.468133123204524, 7.300574279527341], [49.466685373911666, 7.301092942892967], [49.46595185463144, 7.29935971807521], [49.464645508770396, 7.297561354351162], [49.462281300056134, 7.28982434328207], [49.46136320843001, 7.28971043325165], [49.46007780049023, 7.286269749971495], [49.4576894076659, 7.286927387036097], [49.45690246047953, 7.28164817460573], [49.45610829217282, 7.277488571682984], [49.45566253848924, 7.274811233453292], [49.454330821861014, 7.273271016712313], [49.45181521631228, 7.273468080419284], [49.45124809358542, 7.270329597662129], [49.45162060033993, 7.268246529742118], [49.451489901181866, 7.266515065677694], [49.44943136186216, 7.260516409105571], [49.44877216161231, 7.258108043108568], [49.44804923453669, 7.252701671108492], [49.44700678735164, 7.250156694260316], [49.44551838169086, 7.246437659794955], [49.44395411088342, 7.247772950257738], [49.44294579819948, 7.249813158760976], [49.441926879237776, 7.252733169694262], [49.44054813421475, 7.253617662151181], [49.44059740237571, 7.255328278159693], [49.43701699947558, 7.252406719327576], [49.43614091828881, 7.253828339944853], [49.43517793235505, 7.25024633235577], [49.43146537700654, 7.252589155463812], [49.42987836186079, 7.254041534151365], [49.429706085384574, 7.255794451873306], [49.42858642584173, 7.255838471459245], [49.42610317532034, 7.256970796507545], [49.42619205276333, 7.260408340993604], [49.42526436705116, 7.259613441589877], [49.424928653960194, 7.260863328692064], [49.423622181548254, 7.260958404780629], [49.424437136992054, 7.265384450500302], [49.424422730245034, 7.266879124117542], [49.42396514283747, 7.269124145407012], [49.424744652848126, 7.270386439565264], [49.42421313789237, 7.272788930019145], [49.42201783915323, 7.274996516172607], [49.42075584461215, 7.27885028747863], [49.42025450584212, 7.278314268685682], [49.419270828246276, 7.278906249315412], [49.417512379451594, 7.282398617506324], [49.417398141007524, 7.286301463104624], [49.41643529950865, 7.28853284177272], [49.41470528805087, 7.290070228948578], [49.414046046737184, 7.289686542431256], [49.4123536823579, 7.289385851152582], [49.41115028495258, 7.290128832121761], [49.40916865391834, 7.292000213201299], [49.408222481879626, 7.292601446301563], [49.404967011865224, 7.29654492786961], [49.4045810046232, 7.29721922132109], [49.40101169274704, 7.294242900391076], [49.39889805099172, 7.297805688935973], [49.39851936299798, 7.298941266078602], [49.395892136867175, 7.294355648544055], [49.3932937554558, 7.289656049222572], [49.392848867637696, 7.292144387141339], [49.389646338983326, 7.289429792253398], [49.38881434747155, 7.28934125200422], [49.38871480305679, 7.291847988080695], [49.38928377758287, 7.296756685570259], [49.38819469855251, 7.297267719922498], [49.387972219868495, 7.299505415388706], [49.38929724432003, 7.299385698687577], [49.38930976283084, 7.301983463740832], [49.388753712616435, 7.303992941770623], [49.38742056277187, 7.302971844578559], [49.385140706972805, 7.313068052587261], [49.384328869610776, 7.316197610153067], [49.38273934671604, 7.316027266420232], [49.38139681427777, 7.317753007505818], [49.380877731789674, 7.321693751355129], [49.38020756982939, 7.323297557849381], [49.380272190268265, 7.32686509461216], [49.38019078621888, 7.329407975649623], [49.37885010400644, 7.331358268664022], [49.379912907780195, 7.334570245741704], [49.38053822625548, 7.33695616635287], [49.380832118500024, 7.340687899770111], [49.38084120064169, 7.346148461911741], [49.380452651177386, 7.351566149068558], [49.37977014416733, 7.355817014270228], [49.37442171881945, 7.354843745799506], [49.37495235828054, 7.357401298577822], [49.37499384820956, 7.359122652834503], [49.37465730337973, 7.365551804143045], [49.373982566331634, 7.369106571236844], [49.36988656069457, 7.368501084382776], [49.36910043675572, 7.366660704006589], [49.364420036599675, 7.366514163299313], [49.363410358707775, 7.366379587003279], [49.36352351586879, 7.36891625479015], [49.36369564620289, 7.369925165271962], [49.36416072927929, 7.371755916136619], [49.365117016213645, 7.374740301924995], [49.36602822527324, 7.379023643938869], [49.36703767277035, 7.381627988491665], [49.369206542729025, 7.388085128501304], [49.37204605546744, 7.395898693129251], [49.37450398620923, 7.399839897573626], [49.37783013826432, 7.404828735939765], [49.378721709348646, 7.404761984818092], [49.37960314680548, 7.395860889116194], [49.38325687386129, 7.392535277463841], [49.38542111919548, 7.405731643302531], [49.388823355645044, 7.405691489346858], [49.390774863470774, 7.398737971663729], [49.40280537327926, 7.406982984530946], [49.40350196173628, 7.40448222178827], [49.40532059600946, 7.404806340975701], [49.406889659309535, 7.405877875549918], [49.406807157895784, 7.406807649492481], [49.40964814080312, 7.409936037574807], [49.410579887904994, 7.410020992035432], [49.411179282839726, 7.412687922523565], [49.41207792940864, 7.412447506318586], [49.410911628571014, 7.408141442862089], [49.41200350799241, 7.407998012317709], [49.41307489113647, 7.413186555646006], [49.413577459262186, 7.414140014346986], [49.41459364484152, 7.413841368952347], [49.41478919312994, 7.41486250125287], [49.415251138282244, 7.415580878111672], [49.415959957729456, 7.416411598918858], [49.41659666566475, 7.417393036882293], [49.41722790181305, 7.418871447105833], [49.41838541756961, 7.420082390288967], [49.419246398493726, 7.420903456918864], [49.419901989157, 7.421182693520152], [49.420515658816164, 7.421203862442789], [49.42043456002805, 7.420447368772345], [49.42010226449997, 7.41944625232304], [49.41954026901904, 7.418048493409594], [49.41923255639728, 7.416674348370379], [49.419280187395955, 7.415125541359313], [49.42015928392832, 7.412377669543265], [49.42044485043395, 7.411627789735941], [49.42087089523267, 7.411075875102718], [49.42160705496775, 7.410669588379057], [49.422311419145814, 7.410417162617971], [49.42278776981577, 7.410386461347556], [49.4234129172867, 7.410856862038544], [49.42361752710784, 7.411423384230992], [49.423631502709654, 7.411933178761241], [49.42332107257161, 7.413805369962385], [49.423259500876135, 7.415036373560024], [49.423315254684304, 7.416376686759065], [49.423559638455906, 7.417646441727729], [49.423954605724795, 7.41884809939855], [49.42413630771646, 7.419917399734079], [49.424031838664895, 7.420975872837703], [49.423737117389955, 7.422046558091806], [49.42332664758047, 7.423066227987164], [49.42322692660156, 7.424299661061511], [49.42341175973641, 7.425485622418377], [49.423773297310355, 7.426163602500305], [49.42461911883689, 7.42643073923229], [49.42518434958866, 7.426891171956479], [49.42567354524993, 7.428057684601234], [49.42633792233105, 7.429359081140079], [49.42673351233033, 7.429888864743051], [49.426831065730774, 7.430671478853734], [49.42670667757428, 7.431702040509733], [49.42667898948007, 7.432784841797751], [49.4269416239683, 7.433902040540724], [49.427386959499, 7.434537880525412], [49.426309733116085, 7.435355715120655], [49.42526241715352, 7.436262636139397], [49.42401933294533, 7.438320298982742], [49.426239736155466, 7.442889652975907], [49.42750002096789, 7.444562312995439], [49.431218552620905, 7.445845448191708], [49.43191598259202, 7.448408115160007], [49.43267768118551, 7.451025977595566], [49.43377906291203, 7.452626291212805], [49.43474921602154, 7.453876120952521], [49.43486539134945, 7.455842918102015], [49.43463305216023, 7.458908663852373], [49.436520288265875, 7.460114273863248], [49.43774730929305, 7.461942202353351], [49.43821239937051, 7.462538662865073], [49.440002570308565, 7.463339557914774], [49.441241341135154, 7.462457358872412], [49.44270986469803, 7.462145072440681], [49.44390157502366, 7.458635343728566], [49.444794442351004, 7.458111859628277], [49.445647586416186, 7.458013024680619], [49.44710397234307, 7.459016649617181], [49.448184803751595, 7.457965658794072], [49.44886309281469, 7.457114654540031], [49.449951252035135, 7.455949389176136], [49.44917376871777, 7.453623820864007], [49.451731378750516, 7.452182295237455], [49.452913813106406, 7.449220342053142], [49.45328769244276, 7.446323736955193], [49.45394183836552, 7.446064713003656], [49.4545435745097, 7.446195388788208], [49.45543993101479, 7.446741954813008], [49.457000721870365, 7.449153968315129], [49.457798736888506, 7.450721151377516], [49.45856587797862, 7.452894092385712], [49.45953596904641, 7.455005899724579], [49.460196468544, 7.456147287267729], [49.460907453045806, 7.456826632557488], [49.461776233277426, 7.45752012582319], [49.462535265281, 7.457924507887481], [49.46356449091536, 7.457361846303215], [49.463629152565964, 7.458089866236013], [49.46415539032078, 7.460485446431772], [49.466736362595945, 7.461674045119548], [49.46962210852247, 7.460028833901521], [49.47118216321977, 7.459459423719324], [49.4728970268661, 7.459565049879006], [49.4739951306676, 7.46120335657817], [49.47486523413489, 7.462766806176328], [49.47626237900226, 7.466882403868442], [49.47772679745254, 7.470847737093835], [49.47881865094518, 7.472625024087421], [49.479852732980035, 7.473875837720039], [49.480149731568716, 7.472779505500667], [49.48131149631878, 7.47379773118972], [49.48342674822506, 7.47478339860088], [49.485491054262944, 7.476891781490842], [49.48745655924437, 7.48108453712795], [49.49009361988789, 7.481785550208204], [49.49000234518568, 7.483544845219252], [49.494207510184815, 7.478671811500018], [49.495524299541245, 7.478917852092663], [49.49707590944254, 7.478136814002007], [49.49713539310347, 7.479349502643164], [49.497152823937576, 7.482801630984745], [49.4969874457366, 7.485913194461271], [49.49612800077338, 7.486735347875717], [49.4953317110937, 7.488138657423252], [49.497514912152454, 7.494572622831072], [49.50017557212411, 7.496437676196465], [49.50044257372256, 7.49846073212249], [49.50179134498261, 7.498120104727557], [49.504268157881604, 7.500349681562464], [49.50371673498704, 7.501547465133322], [49.504540346662694, 7.502959031161912], [49.50370455802913, 7.503779519382618], [49.50408350724126, 7.506389468911859], [49.504869284966446, 7.506376897181911], [49.50517198732305, 7.508808794417436], [49.50547866626571, 7.509594380845613], [49.50589554268063, 7.510043872918617], [49.50585902129904, 7.511363036307345], [49.50839984475886, 7.511058027017564], [49.509385553675735, 7.511398870547306], [49.50895786663168, 7.512340139379363], [49.509474482391916, 7.514758929523158], [49.508564362637124, 7.515474180684104], [49.5097214428489, 7.518694473872501], [49.51067885574067, 7.519768915286825], [49.51179276165507, 7.522260445859661], [49.512868386996516, 7.524205692108346], [49.51392804688614, 7.525152140714093], [49.51541353167311, 7.52612487310809], [49.516470813896106, 7.52784795336098], [49.517549594044944, 7.52748768925585], [49.518839802033916, 7.527906070342531], [49.52020197261356, 7.526707033293088], [49.521696460274356, 7.526907429729204], [49.52294670379093, 7.527849516966719], [49.52572368181863, 7.526908216301043], [49.52634253216685, 7.526730261877178], [49.52804315865767, 7.529387460398623], [49.527746923817894, 7.530918141340534], [49.526961907365916, 7.53187973990427], [49.52407696350656, 7.533787555251473], [49.52104910593295, 7.535053997808519], [49.5192063048904, 7.536035953928415], [49.51846844886142, 7.537020081847064], [49.51891364202277, 7.540276779876897], [49.51932365856041, 7.544151992156097], [49.517632083322, 7.546631811859139], [49.51781536350726, 7.549259747290902], [49.51854852968073, 7.553366316101856], [49.5187938719295, 7.5558680664558], [49.518792149029125, 7.557766408238123], [49.51825169281979, 7.55839355623749], [49.517453646893934, 7.558038766076288], [49.51760608680492, 7.559682665244321], [49.51835422208686, 7.561799993351298], [49.520254341068444, 7.565624640591764], [49.52236822392166, 7.57353011273413], [49.52379567039669, 7.576153512249273], [49.525412969683956, 7.579460119040886], [49.526450860386994, 7.580538500742573], [49.52558820844582, 7.582552567522762], [49.5282715694645, 7.583150104737137], [49.529394745257, 7.58384282629668], [49.52997416809135, 7.584600634210435], [49.52922285898655, 7.586781017641918], [49.52775593990048, 7.591232500018536], [49.52536719776305, 7.593192771264825], [49.5259018626861, 7.596715537661178], [49.524471872659326, 7.601030848558016], [49.52322039366847, 7.60238738515408], [49.52155211358571, 7.606478027103288], [49.52198118991238, 7.607984560114216], [49.524019639450614, 7.608132733178708], [49.52436234544913, 7.609977932122429], [49.52566405867721, 7.608890663774869], [49.52748773563347, 7.608956966167382], [49.529056652054145, 7.609971718191876], [49.53035899356022, 7.612072201012127], [49.53165069099239, 7.611277685565692], [49.53220035393549, 7.612521743143581], [49.53336453064355, 7.611697914187456], [49.53417600935254, 7.614663165957034], [49.53411444105158, 7.618225242852063], [49.5361058801127, 7.622531948736529], [49.53802687975406, 7.630094203837466], [49.5387069045512, 7.633832888631816], [49.53935522145277, 7.635726684473419], [49.5393226064834, 7.63669495999426], [49.53989712348243, 7.637934367848575], [49.54112771448258, 7.63799249888069], [49.54186114361892, 7.637860727369737], [49.54262822884142, 7.639710236155379], [49.542855970024085, 7.640526728233435], [49.542877302131615, 7.641369401237068], [49.54402063653621, 7.642435571130951], [49.5455154804234, 7.641947112884948], [49.548026591838145, 7.644037535915724], [49.548460541260106, 7.64537350836321], [49.54972105821266, 7.646616248204495], [49.5505151904822, 7.648633745878904], [49.55322020124645, 7.649351155404939], [49.55424349328741, 7.650256761171818], [49.553904545102164, 7.651551131187838], [49.55559240270783, 7.655009575013773], [49.556485832330175, 7.654165506571668], [49.556375343995064, 7.656588726347582], [49.55866653944523, 7.657902509094348], [49.560403410784375, 7.660110488262355], [49.561572664845684, 7.660937621284821], [49.562331153531034, 7.660409186972879], [49.56435661780457, 7.661387523275283], [49.56803515685871, 7.661037216981748], [49.5697367425983, 7.661639366552302], [49.57076871006585, 7.660336045548651], [49.569705250535804, 7.657760661849171], [49.569222554323346, 7.656443039651042], [49.56929513289726, 7.655058027267374], [49.5702429044789, 7.6555138059354], [49.57174600244841, 7.656062242630068], [49.57275553692189, 7.655101444648476], [49.573301409903216, 7.652219921549142], [49.57383688978701, 7.650613451124524], [49.57370715127007, 7.648137750541032], [49.57397084555156, 7.641627739357381], [49.575001193326116, 7.63929561343934], [49.57706262569931, 7.640709022647616], [49.58091210513555, 7.644120240373141], [49.58237853269655, 7.646353702361029], [49.582638785230365, 7.647830288396869], [49.58438827273838, 7.649414993804242], [49.58636402320383, 7.649711135510632], [49.58805286769702, 7.651670002913022], [49.587870345273146, 7.655863025257466], [49.58634882106973, 7.656895107080065], [49.58702245605278, 7.659434424448788], [49.5856051073883, 7.661423866444751], [49.58701648855698, 7.666029825597162], [49.58644060857208, 7.667382971636806], [49.58670856137983, 7.669711969512395], [49.58590714325615, 7.671723392877507], [49.58849344311456, 7.675148457942652], [49.58916008075648, 7.676808691509763], [49.59002271384064, 7.677585192554927], [49.59210971865669, 7.680235176095178], [49.59238831179623, 7.686749375488325], [49.59220808532813, 7.69002528947112], [49.59262500263239, 7.691560665039342], [49.59289433582706, 7.69317333704108], [49.59149642876746, 7.693665854225299], [49.59053848477375, 7.693458304410745], [49.58976718706167, 7.693093237625869], [49.58866356328207, 7.696266451564303], [49.591927876846015, 7.697570576869385], [49.59399517933822, 7.701798079439832], [49.596747900788394, 7.704988625427299], [49.59746180421853, 7.704005017043488], [49.59801124580084, 7.705108616942019], [49.60012099155776, 7.705234499184157], [49.60061162099782, 7.703959160650181], [49.6017354141215, 7.706081962018253], [49.60233177803913, 7.705077441589905], [49.603126554671334, 7.701794164087321], [49.603208163010585, 7.700108614505138], [49.605162847165296, 7.702335155106145], [49.60716981589972, 7.704129360445862], [49.608717255300526, 7.705909037535185], [49.609578281599426, 7.704320861523586], [49.61181222248654, 7.705464718990705], [49.61392878006369, 7.700768594949157], [49.61505489119314, 7.699344725123574], [49.616298800494334, 7.698315700709389], [49.619991753332435, 7.696935010558095], [49.62213795197465, 7.699622136939925], [49.623181581222525, 7.703233306055686], [49.62403815290181, 7.704014625953291], [49.624550328766084, 7.707255216108087], [49.6241423857082, 7.708235299404002], [49.62411280202182, 7.708860651017161], [49.62460359069827, 7.71050882482052], [49.62468291777534, 7.714093515516063], [49.62530347471799, 7.718824645869512], [49.62712506115495, 7.71931446849922], [49.62779116841732, 7.722976087250796], [49.63237431161768, 7.719341346718411], [49.633575044514764, 7.716915041871033], [49.635214422749, 7.716284485886303], [49.63705677832975, 7.716088243285906], [49.63837228975619, 7.717231400622532], [49.63925681233199, 7.718787890369474], [49.64010053564213, 7.722807090924913], [49.640673002690825, 7.725881233553811], [49.64114598586673, 7.727492257499632], [49.64238449924098, 7.728178901474254], [49.64305425145052, 7.728170346767263], [49.643855803266696, 7.727911380916165], [49.644469130117784, 7.727208166233076], [49.645342705598935, 7.726671881456268], [49.64639633932105, 7.726246497008698], [49.647198631074744, 7.726017783478391], [49.64791293613016, 7.726219039686027], [49.64871411570694, 7.726749075687681], [49.649472227700215, 7.727129892024597], [49.649861309000755, 7.726925193103962], [49.64947073773255, 7.725460829498814], [49.647967789680834, 7.722027930623329], [49.64627008445574, 7.720625230677461], [49.646049765374016, 7.718253359427019], [49.6464062463955, 7.715542833582597], [49.647776282251066, 7.711220174253728], [49.648971832015654, 7.710415435656694], [49.649650175491104, 7.709446781056567], [49.65094300612391, 7.708206427514709], [49.65245033929241, 7.707632908550898], [49.65241070632195, 7.706026715273691], [49.65251517970531, 7.703330490343141]]

const worldBounds = [
  [-90, -180],
  [-90, 180],
  [90, 180],
  [90, -180]
];

// Mask component to apply the effect
const MaskLayer = () => {
  const map = useMap();

  React.useEffect(() => {
    const mask = L.polygon([worldBounds, polygonLandkreisKusel], {
      color: "black",
      fillColor: "black",
      fillOpacity: 0.5,
      stroke: false
    }).addTo(map);

    return () => {
      map.removeLayer(mask);
    };
  }, [map]);

  return null;
};



// Fix broken marker icons
delete L.Icon.Default.prototype._getIconUrl;

L.Icon.Default.mergeOptions({
  iconRetinaUrl:
    "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",
  iconUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",
  shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
});

// Create a custom red marker icon
const redIcon = new L.DivIcon({
  className: "custom-marker", // Optional: class for styling if needed
  html: '<div style="background-color: red; width: 30px; height: 30px; border-radius: 50%; border: 2px solid white;"></div>',
  iconSize: [30, 30], // Size of the icon
  iconAnchor: [15, 15], // Anchor point (center of the marker)
});




const PegelWolfsteinMap = ({ hoveredMarkerId, selectedMarkerId }) => {

  const markers = [
    { id: "wolfstein", position: [49.581045, 7.619593], label: "Wolfstein" },
    { id: "rutsweiler", position: [49.566297, 7.623804], label: "Rutsweiler a.d. Lauter" },
    { id: "kreimbach4", position: [49.554087, 7.621883], label: "Kreimbach 4" },
    { id: "lauterecken", position: [49.650507589739846, 7.590545488872102], label: "Lauterecken 1" },
    { id: "kreimbach1", position: [49.54844915352638, 7.631175812962766], label: "Kreimbach 1" },
    { id: "kreimbach3", position: [49.556388641429436, 7.636587365546659], label: "Kreimbach 3" }, 
    { id: "kusel", position: [49.539820952844316, 7.396752597634942], label: "Kusel" }
  ];
  


  const [mapCenter, setMapCenter] = useState(window.innerWidth < 768 ? [49.500444, 7.49246] : [49.560144, 7.49246]);
  const [mapZoom, setMapZoom] = useState(window.innerWidth < 768 ? 10 : 11); // Zoom based on screen size

  useEffect(() => {
    const handleResize = () => {
      // Update mapZoom based on screen width
      setMapZoom(window.innerWidth < 768 ? 10 : 11);
      
      // Update mapCenter based on screen width
      const newCenter = window.innerWidth < 768 
        ? [49.560444, 7.49246] // Slightly lower latitude for smaller screens
        : [49.560144, 7.49246]; // Original latitude for larger screens
      setMapCenter(newCenter);
    };

    window.addEventListener('resize', handleResize);

    // Cleanup event listener on component unmount
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);

  
  const tileLayerUrl = "https://tile.openstreetmap.org/{z}/{x}/{y}.png";

  const [timeType, setTimeType] = useState("past"); // Default to 'past'
  const [frameIndex, setFrameIndex] = useState(8); // Default to 8 (current time)
  const [radarUrl, setRadarUrl] = useState("");

  

  return (
    <MapContainer
      center={mapCenter}
      zoom={mapZoom}
      scrollWheelZoom={false}
      style={{ width: "100%", height: "100%", minHeight: "600px" }}
    >
      <TileLayer
        attribution='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        url={tileLayerUrl}
      />
  
      {/* Add Mask */}
      <MaskLayer />
  
      {/* Add the actual polygon outline */}
      <Polygon positions={polygonLandkreisKusel} color="transparent" fillOpacity={1} />
  
      <RadarFetcher
        setRadarUrl={setRadarUrl}
        timeType={timeType}
        frameIndex={frameIndex}
      />
      
      {radarUrl && (
        <TileLayer
          url={radarUrl}
          attribution='&copy; <a href="https://rainviewer.com" target="_blank">RainViewer</a>'
          opacity={0.5}
        />
      )}
  
      {/* Render markers conditionally */}
      {markers.map((marker) => {
  const isHovered = hoveredMarkerId === marker.id;
  const isSelected = selectedMarkerId === marker.id;

  // Define the marker size based on state
  const markerSize = isSelected ? 34 : isHovered ? 34 : 24;
  
  return (
    <Marker
      key={marker.id}
      position={marker.position}
      icon={L.divIcon({
        className: "custom-marker",
        html: `<div style="
          background-image: url('https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png');
          background-size: contain;
          background-repeat: no-repeat;
          width: ${markerSize}px;
          height: ${markerSize * 1.5}px;
filter: ${isSelected ? 'hue-rotate(170deg) saturate(2) brightness(1.1)' : isHovered ? 'hue-rotate(160deg) saturate(2) brightness(1.1)' : 'hue-rotate(10deg) saturate(1) brightness(1.2)'};
        "></div>`,
        iconSize: [markerSize, markerSize * 1.5],
        iconAnchor: [markerSize/2, markerSize * 1.5],
      })}
    >
      <Popup>{marker.label}</Popup>
    </Marker>
  );
})}
  
      <RainIntensityLegend
        timeType={timeType}
        setTimeType={setTimeType}
        frameIndex={frameIndex}
        setFrameIndex={setFrameIndex}
      />
    </MapContainer>
  );
  
};

export default PegelWolfsteinMap;
